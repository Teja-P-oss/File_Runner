<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowSim GUI</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“·</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e1e1e; }
        ::-webkit-scrollbar-thumb { background: #4a4a4a; border-radius: 4px; }
        .config-link { color: #4ec9b0; text-decoration: underline; cursor: pointer; }
        .config-link:hover { color: #9cdcfe; }
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        .tab { background: #2d2d2d; color: #9ca3af; border-right: 1px solid #1e1e1e; max-width: 150px; }
        .tab.active { background: #1e1e1e; color: #e5e7eb; border-top: 2px solid #4ec9b0; }
        .tab:hover:not(.active) { background: #3e3e42; }

        .resizer-col { width: 4px; cursor: col-resize; background: #3e3e42; transition: background 0.2s; }
        .resizer-col:hover, .resizer-col.resizing { background: #007fd4; }
        .resizer-row { height: 4px; cursor: row-resize; background: #3e3e42; transition: background 0.2s; }
        .resizer-row:hover, .resizer-row.resizing { background: #007fd4; }
    </style>
</head>
<body class="bg-[#1e1e1e] text-gray-300 h-screen flex flex-col font-sans overflow-hidden">

    <header class="bg-[#252526] border-b border-[#3e3e42] h-10 flex items-center justify-between px-4 shrink-0 select-none">
        <div class="flex items-center gap-2 text-sm font-semibold text-gray-200">
            <i class="fa-solid fa-microchip text-blue-400"></i>
            <span>FlowSim GUI</span>
        </div>

        <div class="flex items-center gap-3">
            <div id="status-indicator" class="text-xs text-red-500 flex items-center gap-2 border-r border-[#3e3e42] pr-3 h-5">
                <i class="fa-solid fa-circle text-[8px]"></i> Disconnected
            </div>

            <div class="relative">
                <button onclick="app.toggleQuickLinks(event)" class="px-2 py-1 text-xs bg-[#3e3e42] hover:bg-[#4e4e52] text-gray-200 rounded flex items-center gap-2 transition">
                    <i class="fa-solid fa-link text-blue-400"></i> Quick Links <i class="fa-solid fa-caret-down text-[10px]"></i>
                </button>
                
                <div id="quick-links-menu" class="hidden absolute right-0 top-full mt-1 w-48 bg-[#252526] border border-[#3e3e42] rounded shadow-xl z-50 flex flex-col py-1">
                    <a href="https://www.google.com" target="_blank" class="px-4 py-2 text-xs text-gray-300 hover:bg-[#007fd4] hover:text-white block">Confluence</a>
                    <a href="https://www.google.com" target="_blank" class="px-4 py-2 text-xs text-gray-300 hover:bg-[#007fd4] hover:text-white block">Jira</a>
                    <a href="https://www.google.com" target="_blank" class="px-4 py-2 text-xs text-gray-300 hover:bg-[#007fd4] hover:text-white block">Jenkins Dashboard</a>
                    
                    <div class="relative group">
                        <div class="px-4 py-2 text-xs text-gray-300 hover:bg-[#007fd4] hover:text-white cursor-pointer flex justify-between items-center">
                            <span>Visios</span>
                            <i class="fa-solid fa-caret-right text-[10px]"></i>
                        </div>
                        
                        <div class="hidden group-hover:block absolute left-full top-0 w-40 bg-[#252526] border border-[#3e3e42] rounded shadow-xl -ml-1">
                            <a href="https://www.google.com" target="_blank" class="px-4 py-2 text-xs text-gray-300 hover:bg-[#007fd4] hover:text-white block">System Arch</a>
                            <a href="https://www.google.com" target="_blank" class="px-4 py-2 text-xs text-gray-300 hover:bg-[#007fd4] hover:text-white block">Data Flow</a>
                            <a href="https://www.google.com" target="_blank" class="px-4 py-2 text-xs text-gray-300 hover:bg-[#007fd4] hover:text-white block">Logic Map</a>
                        </div>
                    </div>
                </div>
            </div>

            <button disabled class="px-2 py-1 text-xs bg-purple-600 text-white rounded flex items-center gap-2 opacity-50 cursor-not-allowed">
                <i class="fa-solid fa-robot"></i> Ask Flowsim AI
            </button>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden" id="main-layout">
        
        <aside id="sidebar" class="w-80 bg-[#252526] flex flex-col shrink-0" style="width: 320px;">
            <div class="px-4 py-2 border-b border-[#3e3e42]">
                <div class="text-xs font-bold text-gray-500 uppercase mb-2">Explorer</div>
                <div class="relative">
                    <input type="text" id="search-input" placeholder="Search files..." onkeyup="app.handleSearch(this.value)" class="w-full bg-[#1e1e1e] text-gray-300 text-xs border border-[#3e3e42] rounded px-2 py-1 pr-12 focus:outline-none focus:border-blue-500">
                    <button id="search-clear" onclick="app.clearSearch()" class="hidden absolute right-6 top-0 h-full px-2 text-gray-500 hover:text-gray-200" title="Clear Search">
                        <i class="fa-solid fa-xmark text-[10px]"></i>
                    </button>
                    <i class="fa-solid fa-search absolute right-2 top-1.5 text-gray-500 text-[10px]"></i>
                </div>
            </div>
            
            <div id="explorer-body" class="flex-1 overflow-y-auto py-2 text-sm">
                <div id="file-tree-base"></div>
                <div id="search-results" class="hidden"></div>
            </div>
        </aside>

        <div class="resizer-col" id="resizer-side"></div>

        <main class="flex-1 flex flex-col min-w-0 bg-[#1e1e1e]">
            
            <div class="flex bg-[#252526] h-9">
                <div id="tabs-container" class="flex-1 flex overflow-x-auto overflow-y-hidden select-none scrollbar-hide"></div>
                <button onclick="app.closeAllTabs()" title="Close All" class="px-3 hover:bg-red-900/50 text-gray-400 hover:text-white border-l border-[#3e3e42] flex items-center">
                    <i class="fa-solid fa-trash-can text-xs"></i>
                </button>
            </div>

            <div id="toolbar" class="h-10 bg-[#2d2d2d] border-b border-[#3e3e42] flex items-center justify-between px-4 hidden">
                <div class="flex items-center gap-2 text-sm">
                    <i class="fa-regular fa-file-lines text-blue-400"></i>
                    <span id="filename" class="font-medium text-gray-200">No File</span>
                    <span id="lock-badge" class="ml-2 px-1.5 text-[10px] border border-red-500 text-red-400 rounded cursor-pointer hover:bg-red-900/30 hidden" onclick="app.unlockCurrent()">
                        <i class="fa-solid fa-lock mr-1"></i>LOCKED
                    </span>
                </div>
                <div class="flex gap-2">
                    <button onclick="app.syncP4()" id="btn-sync" class="hidden px-3 py-1 text-xs bg-orange-700 hover:bg-orange-600 text-white rounded transition mr-2"><i class="fa-solid fa-cloud-arrow-down mr-1"></i>Sync P4</button>
                    <button onclick="app.runCurrentTest()" id="btn-run-nav" class="hidden px-3 py-1 text-xs bg-green-700 hover:bg-green-600 text-white rounded transition mr-2"><i class="fa-solid fa-play mr-1"></i>Run Test</button>
                    <button onclick="app.saveCurrent()" id="btn-save" class="px-3 py-1 text-xs bg-blue-600 hover:bg-blue-500 text-white rounded transition disabled:opacity-50 disabled:cursor-not-allowed">Save</button>
                </div>
                <div class="flex gap-2">
                    <button onclick="app.runCurrentTest()" id="btn-run-nav" class="hidden px-3 py-1 text-xs bg-green-700 hover:bg-green-600 text-white rounded transition mr-2"><i class="fa-solid fa-play mr-1"></i>Run Test</button>
                    <button onclick="app.saveCurrent()" id="btn-save" class="px-3 py-1 text-xs bg-blue-600 hover:bg-blue-500 text-white rounded transition disabled:opacity-50 disabled:cursor-not-allowed">Save</button>
                </div>
            </div>

            <div id="editor-wrapper" class="flex-1 relative overflow-hidden flex flex-col">
                <div id="editor-container" class="flex-1 overflow-auto font-mono text-sm leading-6 p-4 outline-none whitespace-pre hidden" contenteditable="false" spellcheck="false"></div>
                
                <div id="empty-state" class="flex-1 flex flex-col items-center justify-center text-gray-600">
                    <i class="fa-solid fa-server text-4xl mb-4"></i>
                    <p>Waiting for server at localhost:5000...</p>
                    <button onclick="app.init()" class="mt-4 text-xs underline">Retry Connection</button>
                </div>
            </div>

            <div class="resizer-row" id="resizer-term"></div>

            <div id="terminal-panel" class="h-48 bg-[#1e1e1e] flex flex-col shrink-0 font-mono text-xs" style="height: 192px;">
                <div class="flex justify-between items-center px-4 py-1 bg-[#252526] border-b border-[#3e3e42]">
                    <span class="text-gray-400 uppercase">Output</span>
                    <div class="flex gap-2">
                        <button id="btn-stop" onclick="app.stopTest()" class="hidden text-red-400 hover:text-red-300 mr-2">
                            <i class="fa-solid fa-stop"></i> STOP
                        </button>
                        <button onclick="document.getElementById('terminal-out').innerText=''" class="hover:text-white"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>
                <div id="terminal-out" class="flex-1 overflow-y-auto p-2 text-green-400 whitespace-pre-wrap"></div>
            </div>
        </main>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        
        const app = {
            tabs: [], 
            activeTab: null,
            currentTestId: null,
            searchTimer: null,
            searchController: null, 

            async init() {
                const rootEl = document.getElementById('file-tree-base');
                rootEl.innerHTML = ''; 
                try {
                    const res = await fetch(`${API_URL}/files`);
                    if(!res.ok) throw new Error();
                    const rootItems = await res.json();
                    this.updateStatus(true);
                    document.getElementById('empty-state').innerHTML = '<p>Select a file from the explorer.</p>';
                    this.renderChildren(rootItems, rootEl, 0);
                } catch (e) {
                    console.error(e);
                    this.updateStatus(false);
                }
            },

            handleSearch(query) {
                const clearBtn = document.getElementById('search-clear');
                const treeBase = document.getElementById('file-tree-base');
                const searchRes = document.getElementById('search-results');

                if (query.trim().length > 0) {
                    clearBtn.classList.remove('hidden');
                    treeBase.classList.add('hidden');
                    searchRes.classList.remove('hidden');
                } else {
                    this.clearSearchState();
                    return;
                }

                if (this.searchController) this.searchController.abort();
                clearTimeout(this.searchTimer);

                this.searchTimer = setTimeout(async () => {
                    this.searchController = new AbortController();
                    const signal = this.searchController.signal;

                    searchRes.innerHTML = '<div class="pl-4 text-gray-500 text-xs"><i class="fa-solid fa-spinner spin"></i> Searching...</div>';
                    
                    try {
                        const res = await fetch(`${API_URL}/search?q=${encodeURIComponent(query)}`, { signal });
                        const items = await res.json();
                        searchRes.innerHTML = '';
                        this.renderChildren(items, searchRes, 0, true);
                    } catch (e) { 
                        if (e.name === 'AbortError') return; 
                        searchRes.innerHTML = '<div class="pl-4 text-red-500">Search Failed</div>'; 
                    }
                }, 150); 
            },

            clearSearchState() {
                document.getElementById('search-clear').classList.add('hidden');
                document.getElementById('file-tree-base').classList.remove('hidden');
                document.getElementById('search-results').classList.add('hidden');
                document.getElementById('search-results').innerHTML = '';
            },

            clearSearch() {
                document.getElementById('search-input').value = '';
                if (this.searchController) this.searchController.abort();
                this.clearSearchState();
            },

            updateStatus(online) {
                const el = document.getElementById('status-indicator');
                el.className = `text-xs ${online ? 'text-green-500' : 'text-red-500'} flex items-center gap-2 border-r border-[#3e3e42] pr-3 h-5`;
                el.innerHTML = `<i class="fa-solid fa-circle text-[8px]"></i> ${online ? 'Connected' : 'Disconnected'}`;
            },
            
            toggleQuickLinks(e) {
                e.stopPropagation();
                const menu = document.getElementById('quick-links-menu');
                menu.classList.toggle('hidden');
            },

            async toggleFolder(path, elementId) {
                const container = document.getElementById(elementId);
                const icon = document.getElementById(`icon-${elementId}`);
                if (container.classList.contains('hidden')) {
                    container.classList.remove('hidden');
                    icon.classList.replace('fa-chevron-right', 'fa-chevron-down');
                    icon.classList.replace('fa-folder', 'fa-folder-open');
                    if (container.innerHTML === '') {
                        container.innerHTML = `<div class="pl-8 py-1 text-gray-500"><i class="fa-solid fa-spinner spin mr-2"></i>Loading...</div>`;
                        try {
                            const res = await fetch(`${API_URL}/files?path=${encodeURIComponent(path)}`);
                            const items = await res.json();
                            container.innerHTML = ''; 
                            this.renderChildren(items, container, parseInt(container.dataset.depth));
                        } catch (e) { container.innerHTML = `<div class="pl-8 text-red-500">Error loading</div>`; }
                    }
                } else {
                    container.classList.add('hidden');
                    icon.classList.replace('fa-chevron-down', 'fa-chevron-right');
                    icon.classList.replace('fa-folder-open', 'fa-folder');
                }
            },

            renderChildren(items, container, depth, isSearch = false) {
                if(items.length === 0) {
                    container.innerHTML += `<div class="py-1 text-gray-600 italic" style="padding-left:${(depth+1)*12 + 12}px">No results</div>`;
                    return;
                }
                items.forEach((item, index) => {
                    const uniqueId = `node-${(isSearch ? 's-' : '')}${item.path.replace(/[^a-zA-Z0-9]/g, '-')}-${index}`; 
                    const padding = isSearch ? 12 : (depth * 12) + 12; 
                    const itemDiv = document.createElement('div');
                    
                    if (item.type === 'dir' && !isSearch) {
                        itemDiv.innerHTML = `
                            <div>
                                <div class="flex items-center py-1 hover:bg-[#37373d] cursor-pointer text-gray-400 hover:text-gray-100 transition-colors" style="padding-left:${padding}px" onclick="app.toggleFolder('${item.path}', '${uniqueId}')">
                                    <i id="icon-${uniqueId}" class="fa-solid fa-chevron-right text-[10px] w-4 text-center mr-1 transition-transform"></i>
                                    <i class="fa-solid fa-folder text-yellow-600 text-xs mr-2"></i>
                                    <span class="truncate" title="${item.name}">${item.name}</span>
                                </div>
                                <div id="${uniqueId}" data-depth="${depth+1}" class="hidden"></div>
                            </div>`;
                    } else if (item.type !== 'dir') {
                        const isIni = item.name.toLowerCase().endsWith('.ini');
                        itemDiv.innerHTML = `
                            <div class="group flex items-center justify-between py-1 pr-2 hover:bg-[#37373d] cursor-pointer text-gray-400 hover:text-gray-100 transition-colors" style="padding-left:${padding + (isSearch ? 0 : 14)}px" onclick="app.loadFile('${item.path}')">
                                <div class="flex items-center gap-2 truncate flex-1" title="${item.name}">
                                    <i class="fa-regular fa-file-lines text-blue-400 text-xs"></i> 
                                    <span class="truncate">${item.name}</span>
                                    ${isSearch ? `<span class="text-[10px] text-gray-600 ml-2 truncate">${item.path}</span>` : ''}
                                </div>
                                <div class="hidden group-hover:flex gap-1">
                                    ${isIni ? `<button onclick="app.runTest('${item.path}', event)" title="Run Test" class="bg-green-700 hover:bg-green-600 text-white px-1.5 rounded text-[10px]"><i class="fa-solid fa-play"></i></button>` : ''}
                                    <button onclick="app.copyPath('${item.path}', event)" title="Copy Path" class="bg-gray-600 hover:bg-gray-500 text-white px-1.5 rounded text-[10px]"><i class="fa-solid fa-copy"></i></button>
                                </div>
                            </div>`;
                    }
                    container.appendChild(itemDiv);
                });
            },

            async loadFile(path) {
                if (path.match(/\.(py|xml|yaml|yml)$/i)) {
                    this.openExternal(path);
                    return;
                }

                const existingTab = this.tabs.find(t => t.path === path);
                if (existingTab) {
                    this.activateTab(path);
                    return;
                }
                const res = await fetch(`${API_URL}/read?path=${encodeURIComponent(path)}`);
                const data = await res.json();
                const newTab = { path: path, name: path.split('/').pop(), content: data.content, locked: data.locked };
                this.tabs.push(newTab);
                this.activateTab(path);
            },

            activateTab(path) {
                const tab = this.tabs.find(t => t.path === path);
                if(!tab) return;
                this.activeTab = tab;
                this.renderTabs();
                this.renderEditor();
            },

            closeTab(path, e) {
                if(e) e.stopPropagation();
                const idx = this.tabs.findIndex(t => t.path === path);
                if(idx === -1) return;
                let newActive = null;
                if (this.activeTab && this.activeTab.path === path) {
                    if (this.tabs.length > 1) newActive = this.tabs[idx === 0 ? 1 : idx - 1];
                } else {
                    newActive = this.activeTab;
                }
                this.tabs.splice(idx, 1);
                if(newActive) this.activateTab(newActive.path);
                else {
                    this.activeTab = null;
                    this.renderTabs();
                    this.renderEditor();
                }
            },
            
            closeAllTabs() {
                this.tabs = [];
                this.activeTab = null;
                this.renderTabs();
                this.renderEditor();
            },

            renderTabs() {
                const container = document.getElementById('tabs-container');
                container.innerHTML = this.tabs.map(t => `
                    <div class="tab flex items-center justify-between px-3 text-xs cursor-pointer shrink-0 ${this.activeTab && this.activeTab.path === t.path ? 'active' : ''}" onclick="app.activateTab('${t.path}')">
                        <span class="truncate mr-2" title="${t.path}">${t.name}</span>
                        <i class="fa-solid fa-xmark hover:text-white rounded p-0.5" onclick="app.closeTab('${t.path}', event)"></i>
                    </div>
                `).join('');
            },

            renderEditor() {
                const emptyState = document.getElementById('empty-state');
                const editorCont = document.getElementById('editor-container');
                const toolbar = document.getElementById('toolbar');

                if (!this.activeTab) {
                    emptyState.classList.remove('hidden');
                    editorCont.classList.add('hidden');
                    toolbar.classList.add('hidden');
                    return;
                }
                emptyState.classList.add('hidden');
                editorCont.classList.remove('hidden');
                toolbar.classList.remove('hidden');
                toolbar.classList.add('flex');
                document.getElementById('filename').innerText = this.activeTab.name;

                const badge = document.getElementById('lock-badge');
                const saveBtn = document.getElementById('btn-save');
                const runBtn = document.getElementById('btn-run-nav');
                const syncBtn = document.getElementById('btn-sync');
                const isIni = this.activeTab.path.toLowerCase().endsWith('.ini');

                
                if(isIni) {
                    runBtn.classList.remove('hidden');
                } else {
                    runBtn.classList.add('hidden');
                }
            
                
                if(isIni) {
                    syncBtn.classList.remove('hidden');
                } else {
                    syncBtn.classList.add('hidden');
                }
                
                if(this.activeTab.path.toLowerCase().endsWith('.ini')) {
                    runBtn.classList.remove('hidden');
                } else {
                    runBtn.classList.add('hidden');
                }

                if(this.activeTab.locked) {
                    badge.classList.remove('hidden');
                    saveBtn.disabled = true;
                    editorCont.setAttribute('contenteditable', 'false');
                } else {
                    badge.classList.add('hidden');
                    saveBtn.disabled = false;
                    editorCont.setAttribute('contenteditable', 'true');
                }
                editorCont.innerHTML = this.parseContent(this.activeTab.content);
            },

            parseContent(text) {
                let html = text.replace(/(=\s*)(Calibration[\\\/][^\s\r\n]+)/g, (match, prefix, path) => {
                    const safePath = path.replace(/\\/g, '\\\\');
                    return `${prefix}<span class="config-link" onclick="app.openExternal('${safePath}')">${path}</span>`;
                });
                
                html = html.replace(/(=\s*)([a-zA-Z_][\w]*(?:\.[\w]+)+)/g, (match, prefix, dotPath) => {
                    const relPath = 'src/' + dotPath.replace(/\./g, '/') + '.py';
                    return `${prefix}<span class="config-link" onclick="app.openExternal('${relPath}')">${dotPath}</span>`;
                });
                
                return html;
            },

            async unlockCurrent() {
                if(!this.activeTab) return;
                await fetch(`${API_URL}/unlock`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ path: this.activeTab.path })
                });
                const res = await fetch(`${API_URL}/read?path=${encodeURIComponent(this.activeTab.path)}`);
                const data = await res.json();
                this.activeTab.content = data.content;
                this.activeTab.locked = data.locked;
                this.renderEditor();
            },

            async saveCurrent() {
                if(!this.activeTab) return;
                const content = document.getElementById('editor-container').innerText;
                this.activeTab.content = content;
                await fetch(`${API_URL}/save`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ path: this.activeTab.path, content })
                });
                alert("Saved!");
            },

            async openExternal(path) {
                await fetch(`${API_URL}/open-external`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ path })
                });
            },

            runCurrentTest() {
                if(this.activeTab) this.runTest(this.activeTab.path);
            },

            async runTest(path, e) {
                if(e) e.stopPropagation();
                const term = document.getElementById('terminal-out');
                const stopBtn = document.getElementById('btn-stop');
                term.innerText += `\n> Running test for ${path}...\n`;
                stopBtn.classList.remove('hidden');
                this.currentTestId = Date.now().toString();

                try {
                    const res = await fetch(`${API_URL}/run-test`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ target: path, testId: this.currentTestId })
                    });
                    const data = await res.json();
                    term.innerText += data.output + "\n-------------------\n";
                } catch(err) {
                    term.innerText += "\nError communicating with server.\n";
                } finally {
                    stopBtn.classList.add('hidden');
                    this.currentTestId = null;
                    term.scrollTop = term.scrollHeight;

                    const c = new (window.AudioContext || window.webkitAudioContext)(), o = c.createOscillator();
                    o.connect(c.destination); o.start(); o.stop(c.currentTime + 0.15); //beep sound
                }
            },

            async stopTest() {
                if(!this.currentTestId) return;
                await fetch(`${API_URL}/stop-test`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ testId: this.currentTestId })
                });
            },

            async syncP4() {
                if(!this.activeTab) return;
                
                const term = document.getElementById('terminal-out');
                term.innerText += `\n> Initiating P4 Sync parsing for ${this.activeTab.name}...\n`;
                
                try {
                    const res = await fetch(`${API_URL}/p4-sync`, {
                        method: 'POST', 
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ path: this.activeTab.path })
                    });
                    const data = await res.json();
                    term.innerText += data.output + "\n-------------------\n";
                    term.scrollTop = term.scrollHeight;
                } catch(err) {
                    term.innerText += `\nError: ${err.message}\n`;
                }
            },

            copyPath(path, e) {
                if(e) e.stopPropagation();
                navigator.clipboard.writeText(path);
                alert("Path copied: " + path);
            }
        };

        window.onclick = function(event) {
            if (!event.target.closest('.relative')) {
                const dropdowns = document.querySelectorAll('#quick-links-menu');
                dropdowns.forEach(d => d.classList.add('hidden'));
            }
        }

        const setupResizer = (resizerId, elementId, isRow) => {
            const resizer = document.getElementById(resizerId);
            const element = document.getElementById(elementId);
            resizer.addEventListener('mousedown', (e) => {
                e.preventDefault();
                resizer.classList.add('resizing');
                document.body.style.cursor = isRow ? 'row-resize' : 'col-resize';
                const onMouseMove = (e) => {
                    if (isRow) {
                        const newHeight = window.innerHeight - e.clientY;
                        if(newHeight > 50 && newHeight < window.innerHeight - 100)
                            element.style.height = newHeight + 'px';
                    } else {
                        const newWidth = e.clientX;
                        if(newWidth > 150 && newWidth < 600)
                            element.style.width = newWidth + 'px';
                    }
                };
                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    resizer.classList.remove('resizing');
                    document.body.style.cursor = '';
                };
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
        };
        setupResizer('resizer-side', 'sidebar', false);
        setupResizer('resizer-term', 'terminal-panel', true);
        app.init();
    </script>
</body>
</html>
